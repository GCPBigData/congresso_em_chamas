<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <script src="./node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./node_modules/bootstrap-treeview-1.2.0/dist/bootstrap-treeview.min.js"></script>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/166647642f.js" crossorigin="anonymous"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script src="./js/newsComponents.js"></script>
    <script src="./js/propositionsComponents.js"></script>
    <script src="./js/twitterComponents.js"></script>
    <title>Politicians</title>
    <style>
        body {
            min-height: 100vh;
            display: grid;
            grid-template-columns: minmax(400px, 1fr) 250px;
            grid-template-rows: 62px auto;
            grid-template-areas:
                'header header'
                'main aside'
        }

        aside {
            grid-area: aside;
        }

        main {
            padding: 15px;
            grid-area: main;
        }

        .card-deck {
            min-width: 400px;
        }

        .card {
            margin-top: 15px;
            min-width: 350px;
        }

        .card-header {
            display: flex;
            justify-content: center;
            align-items: center;
            background: url("../assets/stars_transparent_less.png");
        }

        .card-body {
            padding: 0;
        }

        body>header {
            grid-area: header;
            border: 6px solid;
            border-image: linear-gradient(45deg, rgb(0, 143, 104), rgb(250, 224, 66)) 1;
            display: flex;
            /* O alinhamento pra direita se dá com flex-end e não right */
            justify-content: flex-start;
            align-items: center;
        }

        .fa-twitter {
            color: #00aced;
        }

        .fa-exclamation-triangle {
            color: orangered;
            display: none;
            margin-bottom: 10px;
        }

        .google-logo {
            height: 35px;
            width: 35px;
        }

        .congresso-logo {
            height: 36px;
            width: 42px;
        }

        #propositions-card{
            min-width: 60%;
        }

        #twitter-card{
            height: 700px;
        }

        #news-card{
            min-width: 60%;
        }

        .full-height {
            height: 100%;
        }
        
        #news-list {
            height: 638px;
            overflow: hidden;
            overflow-y: scroll;
        }

        #propositions-list {
            height: 500px;
            overflow: hidden;
            overflow-y: scroll;
        }

        .error-text {
            display: none;
        }

    </style>
</head>

<body>
    <aside class="border"></aside>
    <main>
        <div class="card-deck d-flex justify-content-center">
            <div class="card shadow" id="twitter-card">
                <div class="card-header">
                    <i class="fab fa-twitter fa-2x"></i>
                </div>
                <div class="card-body">
                    <section id="twitter-timeline" class="d-flex flex-column justify-content-center align-items-center full-height">
                        <div class="spinner-border text-warning mt-3" role="status" id="twitter-timeline-spinner"></div>
                        <i class="fas fa-exclamation-triangle fa-2x mt-3" id="twitter-timeline-error-icon"></i>
                        <div class="error-text" id="twitter-error-text">Nenhum político foi encontrado.</div>
                    </section>
                </div>
            </div>
            <div class="card shadow" id="news-card">
                <div class="card-header">
                    <img src="assets/google_logo.png" class="google-logo">
                </div>
                <ul class="list-group" id="news-list">
                    <li class="d-flex flex-column justify-content-center align-items-center full-height">
                        <div class="spinner-border text-warning mt-3" role="status" id="news-spinner"></div>
                        <i class="fas fa-exclamation-triangle fa-2x mt-3" id="news-error-icon"></i>
                        <div class="error-text" id="news-error-text">Nenhum político foi encontrado.</div>
                    </li>
                </ul>
            </div>
            <div class="card shadow" id="propositions-card">
                <div class="card-header">
                    <img src="assets/congresso_icon.png" class="congresso-logo">
                </div>
                <ul class="list-group" id="propositions-list">
                    <li class="d-flex flex-column justify-content-center align-items-center full-height">
                        <div class="spinner-border text-warning mt-3" role="status" id="propositions-spinner"></div>
                        <i class="fas fa-exclamation-triangle fa-2x mt-3" id="propositions-error-icon"></i>
                        <div class="error-text" id="propositions-error-text">Nenhum político foi encontrado.</div>
                    </li>
                </ul>
            </div>
        </div>
    </main>
    <header>
        <img src="assets/perfil.png" width="48px" height="48px">
    </header>
    <script>
        const politician = new URLSearchParams(window.location.search).get("politician");
        let baseUrl = "http://localhost:8080/"
        $.get(`${baseUrl}politicians?name=${politician}`)
        .done(politicianIds => {
            if (politicianIds.length > 0) {
                let politicianId = politicianIds[0];
                $.get(`${baseUrl}politicians/${politicianId}`)
                .done(politician => {
                    renderTwitterTimeline(politician.twitterUsername, twttr, document.getElementById("twitter-timeline"));
                    document.getElementById("twitter-timeline-spinner").style.display = "none";
                    renderNews(politician.news, document.getElementById("news-list"));
                    document.getElementById("news-spinner").style.display = "none";
                })
                $.get(`${baseUrl}politicians/${politicianId}/propositions`)
                .done(propositionsList => {
                    renderPropositions(propositionsList, document.getElementById("propositions-list"));
                    document.getElementById("propositions-spinner").style.display = "none";
                })                
            }
            else {
                document.getElementById("twitter-timeline-error-icon").style.display = "inline-block";
                document.getElementById("twitter-error-text").style.display = "inline-block";
                document.getElementById("twitter-timeline-spinner").style.display = "none";

                document.getElementById("news-error-icon").style.display = "inline-block";
                document.getElementById("news-error-text").style.display = "inline-block";
                document.getElementById("news-spinner").style.display = "none";

                document.getElementById("propositions-error-icon").style.display = "inline-block";
                document.getElementById("propositions-error-text").style.display = "inline-block";
                document.getElementById("propositions-spinner").style.display = "none";
            }
        })
    </script>
</body>

</html>