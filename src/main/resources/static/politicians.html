<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/166647642f.js" crossorigin="anonymous"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <title>Politicians</title>
    <style>
        body {
            min-height: 100vh;
            display: grid;
            grid-template-columns: minmax(400px, 1fr) 250px;
            grid-template-rows: 62px auto;
            grid-template-areas:
                'header header'
                'main aside'
        }

        aside {
            grid-area: aside;
        }

        main {
            padding: 15px;
            grid-area: main;
        }

        .card-deck {
            min-width: 400px;
        }

        .card {
            margin-top: 15px;
            min-width: 350px;
        }

        .card-header {
            display: flex;
            justify-content: center;
            align-items: center;
            background: url("../assets/stars_transparent_less.png");
        }

        .card-body {
            padding: 0;
        }

        body>header {
            grid-area: header;
            border: 6px solid;
            border-image: linear-gradient(45deg, rgb(0, 143, 104), rgb(250, 224, 66)) 1;
            display: flex;
            /* O alinhamento pra direita se dá com flex-end e não right */
            justify-content: flex-start;
            align-items: center;
        }

        .fa-twitter {
            color: #00aced;
        }

        .fa-exclamation-triangle {
            color: orangered;
            display: none;
            margin-bottom: 10px;
        }

        .google-logo {
            height: 35px;
            width: 35px;
        }

        .congresso-logo {
            height: 36px;
            width: 42px;
        }

        #propositions-card{
            min-width: 60%;
        }

        #twitter-card{
            height: 700px;
        }

        #news-card{
            min-width: 60%;
        }

        #twitter-timeline {
            height: 100%;
        }
        
        #news-list {
            height: 638px;
            overflow: hidden;
            overflow-y: scroll;
        }

        #propositions-list {
            height: 500px;
            overflow: hidden;
            overflow-y: scroll;
        }

        .error-text {
            display: none;
        }

    </style>
</head>

<body>
    <aside class="border"></aside>
    <main>
        <div class="card-deck d-flex justify-content-center">
            <div class="card shadow" id="twitter-card">
                <div class="card-header">
                    <i class="fab fa-twitter fa-2x"></i>
                </div>
                <div class="card-body">
                    <section id="twitter-timeline" class="d-flex flex-column justify-content-center align-items-center">
                        <div class="spinner-border text-warning mt-3" role="status" id="twitter-timeline-spinner"></div>
                        <i class="fas fa-exclamation-triangle fa-2x mt-3" id="twitter-timeline-error"></i>
                        <div id="twitter-error-text" class="error-text">Nenhum político foi encontrado.</div>
                    </section>
                </div>
            </div>
            <div class="card shadow" id="news-card">
                <div class="card-header">
                    <img src="assets/google_logo.png" class="google-logo">
                </div>
                <ul class="list-group" id="news-list"></ul>
            </div>
            <div class="card shadow" id="propositions-card">
                <div class="card-header">
                    <img src="assets/congresso_icon.png" class="congresso-logo">
                </div>
                <ul class="list-group" id="propositions-list"></ul>
            </div>
        </div>
    </main>
    <header>
        <img src="assets/perfil.png" width="48px" height="48px">
    </header>
    <script>
        const politician = new URLSearchParams(window.location.search).get("politician");
        const twitterTimelineSpinner = document.getElementById("twitter-timeline-spinner");
        const twitterTimelineError = document.getElementById("twitter-timeline-error");
        const twitterTimelineText = document.getElementById("twitter-error-text");
        $.post("politicians", {
            queryString: politician
        }).done(politicians => {
            if (politicians.length > 0) {
                politicians[0].news.forEach(news => {
                    const newsList = document.getElementById("news-list");
                    newsList.insertAdjacentHTML("beforeend", 
                        `<a href="${news.link}" target="_blank" class="list-group-item list-group-item-action" style="border-color: ${news.mediaOutlet.themeColor}">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">${news.title}</h5>
                                <small>${news.dateString}</small>
                            </div>
                            <p class="mb-1">${news.description}</p>
                            <div style="background-color: ${news.mediaOutlet.themeColor}; margin: 0px -20px -12px -20px">
                                <h6 style="color:#FFFFFF; margin:0px 0px 0px 20px">${news.mediaOutlet.name}</h6>
                            </div>
                        </a>`)
                })
                politicians[0].propositions.forEach(proposition => {
                    const propositionsList = document.getElementById("propositions-list");
                    propositionsList.insertAdjacentHTML("beforeend", 
                        `<li class="list-group-item propositions-list-item">
                            <h5 class="mb-1">${proposition.title}</h5>
                            <a href="${proposition.link}" target="_blank">${proposition.typeDescription}</a>
                        </li>`)
                })
                twttr.widgets.createTimeline(
                    {
                        sourceType: "profile",
                        screenName: politicians[0].twitterUsername
                    },
                    document.getElementById("twitter-timeline"),
                    {
                        chrome: "nofooter noheader",
                        height: "700"
                    }
                );
            }
            else {
                twitterTimelineError.style.display = "inline-block";
                twitterTimelineText.style.display = "inline-block";
            }
            twitterTimelineSpinner.style.display = "none";
        })
    </script>
</body>

</html>